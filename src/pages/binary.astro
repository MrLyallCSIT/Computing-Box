---
const bitLabels = [128, 64, 32, 16, 8, 4, 2, 1];
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Unsigned Binary | Computing:Box</title>

    <style>
      :root{
        --bg: #1f2027;
        --panel: #22242d;
        --text: #e8e8ee;
        --muted: #a9acb8;
        --accent: #33ff7a;
        --accent-dim: rgba(51,255,122,.15);
        --line: rgba(255,255,255,.12);
      }

      /* DSEG7ClassicRegular font */
      @font-face{
        font-family: "DSEG7ClassicRegular";
        src:
          url("/fonts/DSEG7Classic-Regular.ttf") format("truetype"),
          url("/fonts/DSEG7Classic-Regular.woff") format("woff");
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }

      body{
        margin:0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
      }

      .wrap{
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 20px 60px;
      }

      .top{
        display:grid;
        grid-template-columns: 1fr;
        gap: 22px;
        align-items:start;
      }

      .readout{
        background: transparent;
        text-align:center;
        padding: 10px 10px 0;
      }

      .label{
        letter-spacing: .18em;
        font-weight: 700;
        color: var(--muted);
        text-transform: uppercase;
        font-size: 16px;
        margin-top: 8px;
      }

      /* All numbers use DSEG */
      .num{
        font-family: "DSEG7ClassicRegular", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-weight: 400;
        color: var(--accent);
        text-shadow: 0 0 18px var(--accent-dim);
      }

      .value{
        font-size: 64px;
        line-height: 1.0;
        margin: 6px 0 16px;
      }

      .binary{
        font-size: 44px;
        letter-spacing: .12em;
      }

      /* Buttons now UNDER the readout */
      .controls{
        margin-top: 16px;
        display:flex;
        gap: 12px;
        justify-content:center;
        flex-wrap:wrap;
      }

      .btn{
        background: rgba(255,255,255,.06);
        border: 1px solid rgba(255,255,255,.14);
        color: #fff;
        padding: 12px 14px;
        border-radius: 12px;
        font-weight: 700;
        cursor: pointer;
        min-width: 160px;
      }
      .btn:active{ transform: translateY(1px); }

      .bits{
        margin-top: 34px;
        padding-top: 26px;
        border-top: 1px solid var(--line);
        display:grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 18px;
        align-items:end;
        text-align:center;
      }

      .bit{
        display:flex;
        flex-direction:column;
        align-items:center;
        gap: 10px;
        padding: 8px 4px;
      }

      .bitVal{
        font-size: 34px;
        color: var(--text);
        opacity: .95;
      }

      /* Bulb */
      .bulb{
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: rgba(255,255,255,.08);
        border: 1px solid rgba(255,255,255,.12);
        box-shadow: none;
        margin-bottom: 6px;
      }
      .bulb.on{
        background: #ffd86b;
        border-color: rgba(255,216,107,.7);
        box-shadow: 0 0 18px rgba(255,216,107,.6);
      }

      /* Light switch */
      .switch{
        position: relative;
        width: 56px;
        height: 34px;
        display:inline-block;
      }
      .switch input{
        opacity:0;
        width:0;
        height:0;
      }
      .slider{
        position:absolute;
        inset:0;
        background: rgba(255,255,255,.10);
        border: 1px solid rgba(255,255,255,.14);
        border-radius: 999px;
        transition: .18s ease;
      }
      .slider::before{
        content:"";
        position:absolute;
        height: 28px;
        width: 28px;
        left: 3px;
        top: 2px;
        background: rgba(255,255,255,.92);
        border-radius: 50%;
        transition: .18s ease;
      }
      .switch input:checked + .slider{
        background: rgba(51,255,122,.20);
        border-color: rgba(51,255,122,.55);
      }
      .switch input:checked + .slider::before{
        transform: translateX(22px);
        background: var(--accent);
      }

      @media (max-width: 900px){
        .bits{ grid-template-columns: repeat(4, 1fr); }
        .value{ font-size: 54px; }
        .binary{ font-size: 36px; }
      }
    </style>
  </head>

  <body>
    <main class="wrap">
      <section class="top">
        <div class="readout">
          <div class="label">Denary</div>
          <div id="denaryNumber" class="value num">0</div>

          <div class="label">Binary</div>
          <div id="binaryNumber" class="value binary num">00000000</div>

          <!-- Buttons moved HERE (underneath) -->
          <div class="controls">
            <button class="btn" id="btnCustomBinary" type="button">Custom Binary</button>
            <button class="btn" id="btnCustomDenary" type="button">Custom Denary</button>
            <button class="btn" id="btnShiftLeft" type="button">Left Shift</button>
            <button class="btn" id="btnShiftRight" type="button">Right Shift</button>
          </div>
        </div>
      </section>

      <section class="bits" aria-label="Bit switches">
        {bitLabels.map((v) => (
          <div class="bit">
            <div class="bulb" id={`bulb-${v}`} aria-hidden="true"></div>

            <!-- bit place value is a number too -->
            <div class="bitVal num">{v}</div>

            <label class="switch" aria-label={`Toggle bit ${v}`}>
              <input type="checkbox" data-bit={v} />
              <span class="slider"></span>
            </label>
          </div>
        ))}
      </section>
    </main>

    <script type="module">
      const bitLabels = [128, 64, 32, 16, 8, 4, 2, 1];
      const bits = new Map(bitLabels.map(v => [v, false]));

      function updateReadout(){
        let denary = 0;
        let binary = "";

        for (const v of bitLabels){
          const on = bits.get(v);
          if (on) denary += v;
          binary += on ? "1" : "0";
          const bulb = document.getElementById(`bulb-${v}`);
          if (bulb) bulb.classList.toggle("on", on);
        }

        document.getElementById("denaryNumber").innerText = denary.toString();
        document.getElementById("binaryNumber").innerText = binary;
      }

      function setFromBinary(bin){
        const clean = bin.replace(/\s+/g, "");
        if (!/^[01]+$/.test(clean)) return false;

        const padded = clean.slice(-8).padStart(8, "0");
        [...padded].forEach((ch, i) => {
          const v = bitLabels[i];
          const on = ch === "1";
          bits.set(v, on);
          const input = document.querySelector(`input[data-bit="${v}"]`);
          if (input) input.checked = on;
        });

        updateReadout();
        return true;
      }

      function setFromDenary(n){
        n = Number(n);
        if (!Number.isInteger(n) || n < 0 || n > 255) return false;

        for (const v of bitLabels){
          const on = n >= v;
          bits.set(v, on);
          if (on) n -= v;

          const input = document.querySelector(`input[data-bit="${v}"]`);
          if (input) input.checked = on;
        }

        updateReadout();
        return true;
      }

      function shiftLeft(){
        const bin = document.getElementById("binaryNumber").innerText;
        setFromBinary(bin.slice(1) + "0");
      }

      function shiftRight(){
        const bin = document.getElementById("binaryNumber").innerText;
        setFromBinary("0" + bin.slice(0, -1));
      }

      // switches
      document.querySelectorAll('input[type="checkbox"][data-bit]').forEach(input => {
        input.addEventListener("change", () => {
          const v = Number(input.dataset.bit);
          bits.set(v, input.checked);
          updateReadout();
        });
      });

      // buttons
      document.getElementById("btnShiftLeft").addEventListener("click", shiftLeft);
      document.getElementById("btnShiftRight").addEventListener("click", shiftRight);

      document.getElementById("btnCustomBinary").addEventListener("click", () => {
        const val = prompt("Enter an 8-bit binary number (e.g. 01011001):");
        if (val === null) return;
        if (!setFromBinary(val)) alert("Invalid input. Use only 0 and 1 (up to 8 digits).");
      });

      document.getElementById("btnCustomDenary").addEventListener("click", () => {
        const val = prompt("Enter a denary number (0 to 255):");
        if (val === null) return;
        if (!setFromDenary(val)) alert("Invalid input. Enter an integer from 0 to 255.");
      });

      updateReadout();
    </script>
  </body>
</html>
